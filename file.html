<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.5/dist/mindar-image.prod.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>

<script type="module">

import {CSS3DObject} from "https://unpkg.com/three/examples/jsm/renderers/CSS3DRenderer.js";

const THREE = window.MINDAR.IMAGE.THREE;

document.addEventListener("DOMContentLoaded", () => {
const start = async() => {
const mindarThree = new window.MINDAR.IMAGE.MindARThree({
container: document.body, imageTargetSrc: "altabor.mind",
});
const {renderer, cssRenderer, scene, cssScene, camera} = mindarThree;

const ardiv = document.querySelector("#ar-div");
const obj = new CSS3DObject(ardiv);
const cssAnchor = mindarThree.addCSSAnchor(0);
cssAnchor.group.add(obj);

const model = await
tmImage.load("./model.json", "./metadata.json");
const maxPredictions = model.getTotalClasses();

await mindarThree.start();
renderer.setAnimationLoop(() => {
cssRenderer.render(cssScene, camera);
});

let skipCount = 1;

const video = mindarThree.video;

const detect = async () => {
if (skipCount % 10 == 0) {
const prediction = await model.predict(video);

let str="";
for (let i = 0; i < maxPredictions; i++)
str += prediction[i].className + ": "
+ prediction[i].probability.toFixed(2) + "<br>";
ardiv.innerHTML = str;

}
window.requestAnimationFrame(detect);
skipCount++;

}
window.requestAnimationFrame(detect);

}
start();
});

</script>
</body>
</html>
